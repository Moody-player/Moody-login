<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moody ì¸ì¦ ì„¼í„°</title>
    <style>
        /* ë¬´ë”” ìŠ¤íƒ€ì¼ (ë‹¤í¬ëª¨ë“œ + ìŠ¤í¬í‹°íŒŒì´ ê·¸ë¦°) */
        body { background-color: #121212; color: white; font-family: -apple-system, sans-serif; text-align: center; padding: 20px; display: flex; flex-direction: column; justify-content: center; min-height: 90vh; margin: 0; }
        .container { max-width: 400px; margin: 0 auto; }
        h1 { color: #1DB954; margin-bottom: 30px; }
        .card { background: #181818; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        
        input { width: 100%; padding: 15px; margin: 15px 0; border-radius: 8px; border: 1px solid #333; background: #222; color: white; box-sizing: border-box; font-size: 16px; }
        button { width: 100%; padding: 15px; border-radius: 50px; border: none; background-color: #1DB954; color: black; font-weight: bold; font-size: 18px; cursor: pointer; transition: 0.2s; }
        button:hover { background-color: #1ed760; transform: scale(1.02); }
        
        .code-box { display: none; margin-top: 20px; }
        textarea { width: 100%; height: 80px; background: #111; color: #1DB954; border: 1px solid #1DB954; border-radius: 8px; padding: 10px; font-family: monospace; font-size: 14px; resize: none; }
        .guide { font-size: 13px; color: #aaa; margin-bottom: 20px; line-height: 1.5; text-align: left; background: #222; padding: 15px; border-radius: 8px;}
        code { background: #444; padding: 3px; border-radius: 3px; color: #fff; }
    </style>
</head>
<body>

    <div class="container">
        <h1>Moody Setup ğŸµ</h1>

        <div id="step1" class="card">
            <div class="guide">
                <b>1. ì¤€ë¹„ ë‹¨ê³„</b><br>
                Spotify ê°œë°œì ëŒ€ì‹œë³´ë“œì—ì„œ [Redirect URI]ë¥¼ ì•„ë˜ ì£¼ì†Œë¡œ ì„¤ì •í•´ì£¼ì„¸ìš”.<br>
                <code id="current-url" style="display:block; margin-top:8px; word-break:break-all; font-size:11px;">ë¡œë”©ì¤‘...</code>
            </div>

            <p style="font-weight:bold;">2. Client ID ì…ë ¥</p>
            <input type="text" id="clientId" placeholder="ì—¬ê¸°ì— Client IDë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”">
            <button onclick="startAuth()">Spotify ë¡œê·¸ì¸ & ì½”ë“œ ë°›ê¸°</button>
        </div>

        <div id="step2" class="card code-box">
            <h2 style="color:#1DB954; margin-top:0;">âœ… ì¸ì¦ ì„±ê³µ!</h2>
            <p style="color:#ddd; font-size:14px;">ì•„ë˜ ì½”ë“œë¥¼ ë³µì‚¬í•´ì„œ<br>Moody ì„¤ì •ì°½ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.</p>
            
            <textarea id="resultCode" readonly></textarea>
            <button onclick="copyCode()" style="margin-top:15px; background:#fff;">ğŸ“‹ ì½”ë“œ ë³µì‚¬í•˜ê¸°</button>
        </div>
    </div>

    <script>
        // 1. í˜„ì¬ ì´ ì‚¬ì´íŠ¸ ì£¼ì†Œë¥¼ ìë™ìœ¼ë¡œ ê°ì§€í•©ë‹ˆë‹¤.
        const REDIRECT_URI = window.location.origin + window.location.pathname;
        
        // í™”ë©´ì— í˜„ì¬ ì£¼ì†Œ ë³´ì—¬ì£¼ê¸° (ë’¤ì— /ê°€ ìˆë‹¤ë©´ ì œê±°)
        const cleanUrl = REDIRECT_URI.endsWith('/') ? REDIRECT_URI.slice(0, -1) : REDIRECT_URI;
        document.getElementById('current-url').innerText = cleanUrl;

        // 2. ì£¼ì†Œì°½ì— 'code=' ê°€ ìˆëŠ”ì§€ í™•ì¸ (ë¡œê·¸ì¸í•˜ê³  ëŒì•„ì™”ëŠ”ì§€ ì²´í¬)
        const params = new URLSearchParams(window.location.search);
        const code = params.get('code');

        if (code) {
            // ì½”ë“œê°€ ìˆìœ¼ë©´ -> ê²°ê³¼ í™”ë©´ ë³´ì—¬ì£¼ê¸°
            document.getElementById('step1').style.display = 'none';
            document.getElementById('step2').style.display = 'block';
            document.getElementById('resultCode').value = code;
        }

        // 3. ë¡œê·¸ì¸ ë²„íŠ¼ ëˆŒë €ì„ ë•Œ ì‹¤í–‰
        function startAuth() {
            const clientId = document.getElementById('clientId').value.trim();
            if (!clientId) {
                alert("Client IDë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”!");
                return;
            }

            // ìŠ¤í¬í‹°íŒŒì´ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™ì‹œí‚¤ëŠ” ë§í¬ ìƒì„±
            const scope = "user-read-playback-state user-modify-playback-state user-read-currently-playing";
            const authUrl = `https://accounts.spotify.com/authorize?client_id=${clientId}&response_type=code&redirect_uri=${encodeURIComponent(cleanUrl)}&scope=${encodeURIComponent(scope)}`;
            
            window.location.href = authUrl;
        }

        // 4. ë³µì‚¬ ë²„íŠ¼ ê¸°ëŠ¥
        function copyCode() {
            const copyText = document.getElementById("resultCode");
            copyText.select();
            document.execCommand("copy");
            alert("ì½”ë“œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! \nì´ì œ Moody ì„¤ì •ì°½ìœ¼ë¡œ ëŒì•„ê°€ì„¸ìš”.");
        }
    </script>

</body>
</html>